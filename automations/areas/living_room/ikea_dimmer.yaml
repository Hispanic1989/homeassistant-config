---
#
# This automation simulates the use of the IKEA TRADFRI Wireless dimmer
# connected through zha but should also work for other type of events.
# Requires Home Assistant 0.113 or higher.
#
id: 'living_room-ikea_dimmer'
alias: IKEA TRADFRI Wireless dimmer
description: ''
mode: restart
trigger:
  - platform: event
    event_type: zha_event
condition:
  - condition: template
    value_template: '{{ trigger.event.data.device_ieee == "00:0d:6f:ff:fe:a0:54:37" }}'
action:
  - choose:
# Short-Press the on button
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "on" }}'
      sequence:
        - service: light.turn_on
          data_template:
            entity_id: light.woonkamer
            brightness: 254
            hs_color:
              - 38.222
              - 52.941
            transition: 1
# Short-Press the off button
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "off" }}'
      sequence:
        - service: light.turn_off
          data_template:
            entity_id: light.woonkamer
# Long-Press the on button
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "move_with_on_off" }}'
      sequence:
        - repeat:
            while: []
            sequence:
              - service: light.turn_on
                data_template:
                  entity_id: light.woonkamer
                  brightness_step_pct: 10
                  transition: 0.5
              - delay:
                  milliseconds: 500
# Long-Press the off button
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "move" }}'
      sequence:
        - repeat:
            while: []
            sequence:
              - service: light.turn_on
                data_template:
                  entity_id: light.woonkamer
                  brightness_step_pct: -10
                  transition: 0.5
              - delay:
                  milliseconds: 500
# Any other event will cancel the repeat loops (i.e. releasing the button)
    default: []